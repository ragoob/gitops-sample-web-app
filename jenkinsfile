pipeline {
  agent any
  environment {
    WORKSPACE = pwd()
      GOPATH = "${JENKINS_HOME}/jobs/${JOB_NAME}/builds/${BUILD_ID}"
      GO114MODULE = 'on'
      CGO_ENABLED = 0 
  }

  stages {
      stage('unit-test') {
      agent { docker 
      { 
        image 'golang'  
        args '-u root' 
      } 
      }
      steps {
         echo 'Unit test excuting'
          withEnv(["PATH+GO=${GOPATH}/bin"]){
            sh 'make unit-tests'
          }
      }
      }
  }
}
